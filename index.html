<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  
<style>
/* ===== 基本 ===== */
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  padding: 8px;
}

/* ===== ページ切替 ===== */
.page {
  position: absolute;
  top: 36px;
  left: 0;
  width: 100%;
  height: calc(100dvh - 36px);
  background: white;
  z-index: 1;
}

.hidden {
  display: none;
}

/* ===== 問題画面 ===== */
#quiz {
  display: flex;
  flex-direction: column;
  height: calc(100dvh - 36px);
}

/* 上：伸びてOK */
#quizContent {
  flex: 1;
  overflow-y: auto;
  text-align: center;
}

#quizKeyboard {
  flex-shrink: 0;
  padding-bottom: 4px;
  background: white;
}

/* 上部（問題・入力） */
#quizTop {
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: center;
}

/* 問題文 */
#meaning {
  font-size: 24px;
  margin: 12px 0 8px;
}


/* 正誤 */
#judge {
  font-size: 28px;
  font-weight: bold;
  line-height: 1;
}

.correct { color: #2e7d32; }
.wrong   { color: #c62828; }

/* 正解表示 */


/* 入力欄 */
#answerInput {
  display: block;
  margin: 8px auto;
  width: 85%;
  max-width: 340px;
  text-align: center;
}




/* ボタン共通 */
#quiz button {
  font-size: 16px;
  padding: 6px 10px;
}

/* ===== キーボード ===== */
#keyboard {
  margin-top: auto; /* ← これが重要：下に固定される */
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.key-row {
  display: flex;
  justify-content: center;
  gap: 4px;
}

.key-row button {
  min-width: 32px;
  height: 32px;
  font-size: 14px;
}

#keyboard button {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

#keyboard button.active {
  background: #ddd;
}


/* ===== 上部操作 ===== */
#quizControls {
  position: static;
  margin-bottom: 6px;
}

#quizControls button {
  font-size: 12px;
  padding: 4px 6px;
}

/* ===== 一覧画面 ===== */
#list {
  padding: 8px;
  overflow-y: auto;
}

/* ===== 一覧テーブル ===== */
#wordTable {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

#wordTable th,
#wordTable td {
  border: 1px solid #ccc;
  padding: 4px 6px;
  text-align: left;
}

#wordTable th {
  background: #f0f0f0;
  position: sticky;
  top: 0;
}

#progressMini {
  font-size: 14px;
  color: #333;
  margin-bottom: 8px;
}

#wordTable td:last-child:hover {
  background: #eef;
}

/* 正解カード */
#correctWord {
  min-height: 2em;          /* ← 重要：常に場所を確保 */
  padding: 6px 10px;
  border-radius: 6px;
  color: #555;
  font-weight: 500;
  font-size: 16px;
  text-align: center;
  transition: all 0.2s;
}

/* 不正解時だけ強調 */
#correctWord.show {
  background: #fff3e0;
  color: #d84315;
  font-weight: bold;
}

#actionButtons {
  min-height: 44px;
  display: flex;
  gap: 8px;
  justify-content: center;
}



#exampleArea {
  font-size: 14px;
  color: #444;
  margin: 6px 0 10px;
  padding: 6px 8px;
  background: #fafafa;
  border-radius: 6px;
}


#exampleEn {
  font-style: italic;
}

#exampleJa {
  font-size: 13px;
  color: #666;
}

#wordTable td div {
  line-height: 1.3;
}

#answerExample {
  font-size: 14px;
  color: #555;
  margin-top: 4px;
}

/* 未回答（デフォルト） */
#resultArea {
  min-height: 96px;          /* 見た目の安定用 */
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
}



/* 回答後 共通 */
#resultArea.show {
  background: #f6f7f8;   /* ベース色（ほぼ白） */
}

/* 正解 */
#resultArea.show.correct {
  background: #eef8f1;   /* うすい緑 */
}

/* 不正解 */
#resultArea.show.wrong {
  background: #fdf1f1;   /* うすい赤 */
}

#resultBlock {
  min-height: 150px;     /* ← これが効く */
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 8px;
}

#answerControlArea {
  flex-shrink: 0;            /* 押しつぶされない */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

button,
#resultArea,
#actionButtons {
  touch-action: manipulation;
}

/* ===== 見やすさ調整（追加） ===== */

#meaning {
  font-size: 1.5rem;
  margin: 14px 0 10px;
}

#exampleArea {
  font-size: 0.95rem;
  line-height: 1.5;
}

#exampleEn {
  font-size: 1rem;
}

#exampleJa {
  font-size: 0.95rem;
}

#judge {
  font-size: 2rem;
}

#correctWord {
  font-size: 1.2rem;
}

#correctWord.show {
  font-weight: 600;
}

#answerExample {
  font-size: 1rem;
  line-height: 1.4;
}

#answerInput {
  font-size: 1.4rem;
  padding: 8px 6px;
}

#quiz button {
  font-size: 1rem;
}


  
</style>
</head>

<body>

<div id="quizControls">
  <button onclick="goToQuiz()">問題</button>
  <button onclick="showPage('list')">一覧</button>
  <button onclick="toggleWrongOnlyMode()">不正解のみ</button>
  <button onclick="resetProgress()">リセット</button>
</div>


  
<main>

<section id="quiz" class="page">

  <!-- 上：キーボード以外 -->
  <div id="quizContent">
    <div id="progressMini"></div>

    <div id="meaning"></div>

    <div id="exampleArea">
      <div id="exampleEn"></div>
      <div id="exampleJa"></div>
    </div>

  </div>

  <div id="resultArea">
    <div id="judge"></div>
    <div id="correctWord"></div>
    <div id="answerExample"></div>
  </div>

  <!-- 回答操作（← resultArea の外） -->
  <div id="answerControlArea">
    <input id="answerInput" type="text" readonly>
    <div id="actionButtons">
      <button id="checkBtn">回答</button>
      <button id="nextBtn">次へ</button>
      <button id="toggleBtn">正誤切替</button>
    </div>
  </div>

  
  <!-- 下：キーボード -->
  <div id="quizKeyboard">
    <div id="keyboard"></div>

    <select id="keyboardSelect">
      <option value="mobile">アルファベット配列</option>
      <option value="qwerty">QWERTY</option>
    </select>
  </div>

</section>



<section id="list" class="page hidden">
  <select id="filter">
    <option value="all">全て</option>
    <option value="correct">正解</option>
    <option value="wrong">不正解</option>
    <option value="unanswered">未出題</option>
  </select>
  <table id="wordTable"></table>
</section>

</main>

// ========= main.js 統合部分 =========
let progress = {};
let current = null;
let lastJudge = null;
let wrongOnlyMode = false;
let currentLayout = localStorage.getItem("keyboardLayout") || "mobile";
let unattemptedOnlyMode = false;

  
const keyboardLayouts = {
  mobile: [
    ["a","b","c","d","e","f","g","h","i"],
    ["j","k","l","m","n","o","p","q","r"],
    ["shift","s","t","u","v","w","x","y","z","del"]
  ],
  qwerty: [
    ["q","w","e","r","t","y","u","i","o","p"],
    ["a","s","d","f","g","h","j","k","l"],
    ["shift","z","x","c","v","b","n","m","del"]
  ]
};


const meaning = document.getElementById("meaning");
const judge = document.getElementById("judge");
const correctWord = document.getElementById("correctWord");
const input = document.getElementById("answerInput");
const checkBtn = document.getElementById("checkBtn");
const nextBtn = document.getElementById("nextBtn");
const toggleBtn = document.getElementById("toggleBtn");
const progressMini = document.getElementById("progressMini");
const exampleEn = document.getElementById("exampleEn");
const exampleJa = document.getElementById("exampleJa");
const answerExample = document.getElementById("answerExample");


function getNextWord() {
  const list = words.filter(w => {
    const s = progress[w.word.toLowerCase()];

    if (wrongOnlyMode) {
      return s === "wrong";
    }

    if (unattemptedOnlyMode) {
      return s === undefined;
    }

    return s !== "correct";
  });

  return list.length
    ? list[Math.floor(Math.random() * list.length)]
    : null;
}


function updateProgressMini() {
  if (!progressMini) return;

  // 不正解数
  const wrongCount =
    Object.values(progress).filter(v => v === "wrong").length;

  if (wrongOnlyMode) {
    progressMini.textContent = `不正解：${wrongCount} 問`;
  } else {
    progressMini.textContent =
      `進捗：${Object.keys(progress).length} / ${words.length}`;
  }
}



function renderQuestion() {
  current = getNextWord();
  lastJudge = null;

  if (!current) {
    meaning.textContent = "学習完了！";
    return;
  }

  meaning.textContent = current.meaning;
  judge.textContent = "";
  judge.className = "";
  input.value = "";
  correctWord.textContent = "";
  correctWord.classList.remove("show");

  if (current.example) {
    exampleEn.textContent = current.example;
    exampleJa.textContent = current.exampleJa || "";
  } else {
    exampleEn.textContent = "";
    exampleJa.textContent = "";
  }
  checkBtn.disabled = false;
  nextBtn.classList.add("hidden");
  toggleBtn.classList.add("hidden");

  answerExample.textContent = "";
  answerExample.classList.add("hidden");

  resultArea.classList.remove("show", "correct", "wrong");

}

checkBtn.onclick = () => {
  const ok = input.value === current.word;
  lastJudge = ok ? "correct" : "wrong";

  judge.textContent = ok ? "◎" : "✕";
  judge.className = ok ? "correct" : "wrong";

  // ★ クラスを必ずリセットしてから付ける
  resultArea.classList.remove("correct", "wrong");
  resultArea.classList.add("show", ok ? "correct" : "wrong");

  correctWord.textContent = "答え: " + current.word;
  correctWord.classList.remove("hidden");

  if (current.example && answerExample) {
    answerExample.textContent =
      current.example.replace(/_+/g, current.word);
    answerExample.classList.remove("hidden");
  }

  checkBtn.disabled = true;
  nextBtn.classList.remove("hidden");
  toggleBtn.classList.remove("hidden");
};

toggleBtn.onclick = () => {
  if (!current || !lastJudge) return;

  const nowCorrect = lastJudge === "wrong";
  lastJudge = nowCorrect ? "correct" : "wrong";

  judge.textContent = nowCorrect ? "◎" : "✕";
  judge.className = nowCorrect ? "correct" : "wrong";

  resultArea.classList.remove("correct", "wrong");
  resultArea.classList.add("show", nowCorrect ? "correct" : "wrong");
};


nextBtn.onclick = () => {
  if (!current || !lastJudge) return;

  const key = current.word.toLowerCase();   // ★ 必須
  progress[key] = lastJudge;

  localStorage.setItem("progress", JSON.stringify(progress));
  updateProgressMini();
  renderQuestion();
};



function loadData() {
  progress = JSON.parse(localStorage.getItem("progress") || "{}");
  updateProgressMini();   // ← 追加
  renderQuestion();
}
  
function toggleWrongOnlyMode() {
  wrongOnlyMode = !wrongOnlyMode;
  unattemptedOnlyMode = false;

  updateProgressMini();   // ← これ
  renderQuestion();
}


function resetProgress() {
  if (!confirm("リセットしますか？")) return;
  progress = {};
  localStorage.removeItem("progress");
  wrongOnlyMode = false;
  renderQuestion();
}

function renderList() {
  const table = document.getElementById("wordTable");
  const filter = document.getElementById("filter")?.value || "all";

  table.innerHTML = "";

  /* ===== ヘッダー ===== */
  const thead = document.createElement("thead");
  const headRow = document.createElement("tr");

  ["単語", "意味", "状態"].forEach(text => {
    const th = document.createElement("th");
    th.textContent = text;
    headRow.appendChild(th);
  });

  thead.appendChild(headRow);
  table.appendChild(thead);

  /* ===== 本体 ===== */
  const tbody = document.createElement("tbody");

  words.forEach(w => {
    const key = w.word.toLowerCase();
    const state = progress[key]; // "correct" | "wrong" | undefined

    /* --- フィルター判定 --- */
    if (filter === "correct" && state !== "correct") return;
    if (filter === "wrong" && state !== "wrong") return;
    if (filter === "unanswered" && state !== undefined) return;

    const tr = document.createElement("tr");

    /* 単語 */
    const tdWord = document.createElement("td");
    tdWord.textContent = w.word;

    /* 意味・例文 */
    const tdMeaning = document.createElement("td");

    const meaningDiv = document.createElement("div");
    meaningDiv.textContent = w.meaning;
    tdMeaning.appendChild(meaningDiv);

    if (w.example) {
      const exDiv = document.createElement("div");
      exDiv.textContent = w.example.replace("_____", w.word);
      exDiv.style.fontSize = "12px";
      exDiv.style.color = "#555";
      exDiv.style.marginTop = "2px";
      tdMeaning.appendChild(exDiv);
    }

    if (w.exampleJa) {
      const jaDiv = document.createElement("div");
      jaDiv.textContent = w.exampleJa;
      jaDiv.style.fontSize = "12px";
      jaDiv.style.color = "#777";
      tdMeaning.appendChild(jaDiv);
    }

    /* 状態 */
    const tdStatus = document.createElement("td");
    tdStatus.textContent =
      state === "correct" ? "〇" :
      state === "wrong"   ? "×" : "";

    tdStatus.style.cursor = "pointer";

    /* ワンタッチ循環 */
    tdStatus.onclick = () => {
      if (!progress[key]) {
        progress[key] = "correct";
      } else if (progress[key] === "correct") {
        progress[key] = "wrong";
      } else {
        delete progress[key];
      }

      localStorage.setItem("progress", JSON.stringify(progress));
      renderList();
    };

    tr.appendChild(tdWord);
    tr.appendChild(tdMeaning);
    tr.appendChild(tdStatus);

    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
}



function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");

  if (id === "list") {
    renderList();
  }
}

function goToQuiz() {
  if (wrongOnlyMode) {
    wrongOnlyMode = false;
    unattemptedOnlyMode = true;
  }

  updateProgressMini();   // ← これ
  showPage("quiz");
  renderQuestion();
}


  
document.getElementById("filter").onchange = renderList;

loadData();

/* ===== キーボード ===== */
const keyboard = document.getElementById("keyboard");
let upper = false;

function buildKeyboard() {
  keyboard.innerHTML = "";

  const layout = keyboardLayouts[currentLayout];

  layout.forEach(row => {
    const rowDiv = document.createElement("div");
    rowDiv.className = "key-row";

    row.forEach(ch => {
      const btn = document.createElement("button");

      // 表示テキスト
      if (ch === "shift") {
        btn.textContent = "Shift";
        btn.classList.toggle("active", upper);

        btn.onclick = () => {
          upper = !upper;      // ← 押すたびに ON / OFF
          buildKeyboard();
        };
      } else if (ch === "del") {
        btn.textContent = "⌫";

        btn.onclick = () => {
          input.value = input.value.slice(0, -1);
        };

      } else {
        // 通常文字キー
        btn.textContent = upper ? ch.toUpperCase() : ch;

        btn.onclick = () => {
          input.value += upper ? ch.toUpperCase() : ch;

          // 1文字入力後に Shift を解除
          if (upper) {
            upper = false;
            buildKeyboard();
          }
        };
      }

      rowDiv.appendChild(btn);
    });

    keyboard.appendChild(rowDiv);
  });
}


const keyboardSelect = document.getElementById("keyboardSelect");
keyboardSelect.value = currentLayout;

keyboardSelect.onchange = () => {
  currentLayout = keyboardSelect.value;
  localStorage.setItem("keyboardLayout", currentLayout);
  buildKeyboard();
};

buildKeyboard();

</script>

</body>
</html>

